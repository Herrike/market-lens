import{r as o,j as e,a as N,b as w,c as S,d as C,h as F,L as M,z as E,Q as L}from"./react-BL7NZTwX.js";import{S as c,h as u,g as I}from"./chart-feature-DfsoJwOB.js";import{b as y,v as Q}from"./services-DBTcWprW.js";import{c as R}from"./vendor-DgxwFaKl.js";import"./charts-R_cfc7Tx.js";const T=()=>{const{searchQuery:a,setSearchQuery:l}=o.useContext(c),[r,s]=o.useState(null),{error:t,isLoading:d}=y(a),i="flex-1 block w-full rounded-l-md rounded-r-none bg-white py-1.5 px-3 text-gray-900 placeholder:text-gray-400 focus:z-10 sm:text-sm/6 dark:bg-gray-900 dark:text-white dark:placeholder:text-gray-500/70",f="!text-red-900 !placeholder:text-red-300 dark:!bg-white/5 dark:!text-red-400 dark:!placeholder:text-red-400/70",b="!bg-gray-100 !text-gray-400 !cursor-not-allowed dark:!bg-gray-800/50 dark:!text-gray-600",p="inline-flex items-center rounded-l-none rounded-r-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 cursor-pointer dark:bg-indigo-500 dark:hover:bg-indigo-400",k="inline-flex items-center rounded-l-none rounded-r-md bg-gray-300 px-3 py-1.5 text-sm font-semibold text-gray-500 shadow-xs cursor-not-allowed dark:bg-gray-700 dark:text-gray-500",j=o.useCallback(x=>{x.preventDefault();const m=new FormData(x.currentTarget).get("search"),h=typeof m=="string"?m:"";if(s(null),h)try{const n=Q(h);n!==a&&l(n)}catch(n){const g=n instanceof Error?n.message:"Invalid stock symbol format",v=g.includes("Invalid stock symbol format")?"Please enter a valid stock symbol (e.g., AAPL, MSFT, ^DJI)":g.includes("empty")?"Please enter a stock symbol":"Invalid ticker format - please use letters, numbers, dots, or dashes only";s(v)}},[a,l]);return e.jsx("form",{onSubmit:j,children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"search",className:"block text-sm/6 font-medium text-gray-900 dark:text-white",children:"Search a stock by their code."}),e.jsxs("div",{className:"mt-2 flex",children:[e.jsx("input",{defaultValue:"",id:"search",name:"search",type:"search",placeholder:"Enter stock symbol (e.g., AAPL)",disabled:d,"aria-invalid":!!(r||t),"aria-describedby":r||t?"search-error":void 0,className:R(i,(r||t)&&f,d&&b)}),e.jsx("button",{type:"submit",disabled:d,className:d?k:p,"aria-label":d?"Searching...":"Search for stock",children:e.jsx(N,{className:"h-4 w-4","aria-hidden":"true"})})]}),(r||t)&&e.jsx("p",{id:"search-error",className:"mt-2 text-sm text-red-600 dark:text-red-400",children:r||u(t,"Search failed. Please try again.").userMessage})]})})},A=({stock:a})=>{const{searchModalToggle:l,setSelectedStock:r,setSearchModalToggle:s}=o.useContext(c),t=o.useCallback(()=>{r(a.symbol),l&&s(!1)},[l,s,r,a]);return e.jsx("button",{type:"button",onClick:t,className:"group w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg border border-transparent hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-200 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors","data-testid":`ticker-${a.symbol.toLowerCase()}`,children:a.symbol}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:a.currency})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:a.exchangeFullName})]})}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(w,{className:"h-4 w-4 text-gray-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors"})})]})})},$=({results:a,isLoading:l,error:r,query:s})=>{if(!s||s.length<1)return null;if(l)return e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((t,d)=>e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg h-16"},d))}),e.jsxs("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 mt-2",children:['Searching for "',s,'"...']})]});if(r){const t=u(r,"Failed to search stocks"),d=I(t.code);return e.jsx("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(S,{className:"h-5 w-5 text-red-400 dark:text-red-300 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h2",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Search failed"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:t.userMessage}),d&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2 leading-relaxed",children:["ðŸ’¡ ",d]})]})]})})}return!a||a.length===0?e.jsxs("div",{className:"mt-4 py-8 px-6 text-center",children:[e.jsx(C,{className:"mx-auto h-16 w-16 text-gray-400 dark:text-gray-500"}),e.jsx("h2",{className:"mt-6 text-lg font-medium text-gray-900 dark:text-white",children:"No stocks found"}),e.jsxs("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400 max-w-sm mx-auto leading-relaxed",children:['No results for "',s,'". Try a different symbol or company name.']})]}):e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"mb-3 text-center",children:e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.length," result",a.length!==1?"s":"",' found for "',s,'"']})}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50/50 dark:bg-gray-800/50",children:a.map(t=>e.jsx(A,{stock:t},`${t.symbol}-${t.exchange}`))}),a.length>=10&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:["Showing first ",a.length," results"]})]})},_=()=>{const{searchModalToggle:a,setSearchModalToggle:l,searchQuery:r}=o.useContext(c),{data:s,isLoading:t,error:d}=y(r),i=o.useCallback(()=>{l(!1)},[l]);return e.jsx("div",{"data-testid":"search-modal-wrapper",children:e.jsxs(F,{open:a,onClose:i,className:"relative z-10","data-testid":"search-modal-dialog",children:[e.jsx(M,{transition:!0,className:"fixed inset-0 lg:left-72 bg-gray-500/75 backdrop-blur-sm transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in dark:bg-gray-900/50","data-testid":"search-modal-backdrop"}),e.jsx("div",{className:"fixed inset-0 lg:left-72 z-10 w-screen lg:w-auto overflow-y-auto","data-testid":"search-modal-container",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center","data-testid":"search-modal-centered",children:e.jsx(E,{transition:!0,className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:max-w-lg sm:p-6 data-closed:sm:translate-y-0 dark:bg-gray-800","data-testid":"search-modal-panel",children:e.jsx("div",{"data-testid":"search-modal-content",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-5","data-testid":"search-modal-header",children:[e.jsx(L,{as:"h3",className:"text-base font-semibold text-gray-900 dark:text-white","data-testid":"search-modal-title",children:"Lens on Stocks"}),e.jsx("div",{className:"mt-2",children:e.jsx(T,{})}),e.jsx("div",{className:"mt-2",children:e.jsx($,{results:s,isLoading:t,error:d||null,query:r})})]})})})})})]})})};export{_ as default};
